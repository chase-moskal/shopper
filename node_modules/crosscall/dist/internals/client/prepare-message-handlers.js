export const prepareMessageHandlers = ({ state, resolveReady }) => {
    function passResponseToRequest(response) {
        const pending = state.requests.get(response.associate);
        if (!pending)
            throw new Error(`unknown response, id "${response.id}" `
                + `responding to "${response.associate}"`);
        const { resolve, reject } = pending;
        state.requests.delete(response.associate);
        if (response.signal === 0 /* Signal.Error */)
            reject(response.error);
        else
            resolve(response);
    }
    const prepPasser = () => async (response) => passResponseToRequest(response);
    return {
        [0 /* Signal.Error */]: prepPasser(),
        [1 /* Signal.Wakeup */]: async () => {
            if (!state.isReady) {
                resolveReady();
                state.isReady = true;
            }
        },
        [3 /* Signal.CallResponse */]: prepPasser(),
        [6 /* Signal.EventListenResponse */]: prepPasser(),
        [8 /* Signal.EventUnlistenResponse */]: prepPasser(),
        [4 /* Signal.Event */]: async (message) => {
            const { listenerOrganizer } = state;
            const { listenerId, eventPayload } = message;
            const listener = listenerOrganizer.listeners.get(listenerId);
            if (listener)
                listener(eventPayload);
        }
    };
};
//# sourceMappingURL=prepare-message-handlers.js.map